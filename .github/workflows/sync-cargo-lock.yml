name: sync-cargo-lock
run-name: Sync local Cargo.lock from eclipse-zenoh/zenoh
# TODO: on push from eclipse-zenoh/zenoh?
on: [push]
jobs:
  sync-file:
    runs-on: ubuntu-latest
    steps:
      - name: Checkout repository
        uses: actions/checkout@v4
      - name: Install Rust toolchain
        # Showing the active Rust toolchain (defined by the rust-toolchain.toml file)
        # will have the side effect of installing it; if it's not installed already.
        run: rustup show
      - name: Override Cargo.lock with eclipse-zenoh/zenoh
        run: curl https://raw.githubusercontent.com/eclipse-zenoh/zenoh/master/Cargo.lock --output Cargo.lock
      - name: Fixup Cargo.lock
        # Checking the package for errors will rectify the Cargo.lock while preserving
        # the dependency specifications fetched from eclipse-zenoh/zenoh.
        run: cargo check
      - name: Create a pull request if Cargo.lock changed
        uses: peter-evans/create-pull-request@v5
